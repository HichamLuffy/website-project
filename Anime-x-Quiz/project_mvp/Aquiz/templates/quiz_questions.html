{% extends "layout.html" %}
{% block content %}
<div class="question-container">
    <h1>{{ quiz.title }}</h1>
    <p>Number of questions: {{ num_questions }}</p>
    <p>Category: {{ quiz.category }}</p>
    <p>Level: {{ quiz.level }}</p>
    <hr>
    <form method="POST" action="{{ url_for('quiz_questions', quiz_id=quiz.id) }}">
        {% for question in questions %}
        <div class="question {% if loop.first %}active{% endif %}">
            <div class="question-box">
                <h3>{{ question.question_text }}</h3>
                {% if quiz.category == 'image' and question.image_path %}
                <div class="image-box">
                    <img src="{{ question.image_path }}" alt="Question Image">
                </div>
                {% endif %}
                {% if quiz.category == 'sound' and question.sound_path %}
                <audio controls>
                    <source src="{{ question.sound_path }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                {% endif %}
            </div>
            <div class="options-box">
                <ul>
                    {% for option in question.options %}
                    <li>
                        <label class="option-label">
                            <input type="radio" name="question{{ question.id }}" value="{{ option.id }}" class="radio-input">
                            <span class="option-text">{{ option.text }}</span>
                        </label>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
        <a class="prev">Previous</a>
        <a class="next">Next</a>
        <button type="submit" id="submitBtn" style="display: none;">Submit Answers</button>
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var currentQuestion = 0;
    var questions = $('.question');

    function showQuestion(index) {
        questions.each(function(i, question) {
            if (i === index) {
                $(question).addClass('active');
            } else {
                $(question).removeClass('active');
            }
        });
        $('.prev').toggle(currentQuestion !== 0);
        $('#submitBtn').toggle(currentQuestion === questions.length - 1);
    }

    $('.next').click(function() {
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            showQuestion(currentQuestion);
        }
    });

    $('.prev').click(function() {
        if (currentQuestion > 0) {
            currentQuestion--;
            showQuestion(currentQuestion);
        }
    });

    // jQuery for handling radio button clicks
    $('.option-label').click(function() {
        var radioInput = $(this).find('.radio-input');
        // Uncheck all other radio inputs in the same question
        var allRadioInputs = $('input[name="' + radioInput.attr('name') + '"]');
        allRadioInputs.prop('checked', false);
        // Check the clicked radio input
        radioInput.prop('checked', true);

        // Remove checked class from all option labels
        $('.option-label').removeClass('checked');
        // Add checked class to the clicked option label
        $(this).addClass('checked');
    });
</script>
{% endblock %}
