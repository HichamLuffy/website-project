{% extends "layout.html" %}
{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.4.5/swiper-bundle.min.js"></script>
<div class="content">
    <div class="content-text">
        <h1> Test your anime<br> knowledge with<br> AQZ!</h1>
        <p>Challenge yourself with our anime quizzes and see how much you know.</p>
        <a href="/quiz" class="bn3637 bn37">Play</a>
    </div>
    <div class="rectangle-overlay"></div>
</div>
<div class="content2">
    <div class="text-container">
        <h5>Discover <span class="movie-night">AQZ</span></h5>
        <p>Welcome to AQZ, the ultimate Anime Quiz experience.<br>
        Choose from a variety of categories including openings, characters, logos, and more and put your knowledge to the test.<br>
        Challenge yourself and see how well you know your favorite anime!</p>
        <!-- <button class="btnaa">Start now</button> -->
    </div>
    <div class="image-container">
        <div class="gradient-overlay"></div>
        <img src="../static/images/content2.png" alt="Quiz">
    </div>
</div>
<section class="main-section">
  <div class="cards">
    <div class="information">
      <h5>Explore Anime Quiz <span class="movie-night">categories</span></h5>
      <p>Choose from a variety of questions such as voice, eyes, smile, clothing, hair, and weapons to test your anime knowledge.</p>
      <h5><span class="movie-night">Create</span> Your Own Quizzes</h5>
      <p>Login to post your own quizzes, create polls, and challenge others to test their anime knowledge.</p>
      <h5>Customize Your <span class="movie-night">Profile</span></h5>
      <p>Personalize your profile, earn badges, and showcase your anime quiz achievements to the community</p>
    </div>
    <div class="swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <h2>Guess Characters From Face</h2>
        </div>

        <div class="swiper-slide">
          <h2>Guess Characters From Place</h2>
        </div>

        <div class="swiper-slide">
          <h2>Guess Characters From Laugh</h2>
        </div>

        <div class="swiper-slide">
          <h2>Guess Characters From Eye</h2>
        </div>
      </div>
    </div>
  </div>

  <ul class="circle-back">
    <li></li>
    <li></li>
    <li></li>
  </ul>
</section>
<div class="comments-section">
  <button id="left-arrow" class="arrow">&lt;</button> <!-- Left arrow -->
  <div class="comments-container" id="comments-container">
      <!-- Comments will be dynamically added here -->
  </div>
  <button id="right-arrow" class="arrow">&gt;</button> <!-- Right arrow -->
  <div class="dots-container" id="dots-container"></div> <!-- Container for dots -->
</div>


<script>
function fetchAndAppendComments() {
  fetch('/comments')
      .then(response => response.json())
      .then(comments => {
          const commentsContainer = document.getElementById('comments-container');
          commentsContainer.innerHTML = ''; // Clear existing comments
          comments.forEach(comment => {
              const commentBox = document.createElement('div');
              commentBox.classList.add('comment-box');
              // Update the innerHTML structure here
              commentBox.innerHTML = `
                  <div class="rating">${generateStars(comment.rating)}</div>
                  <div class="comment-text">${comment.text}</div>
                  <div class="user-info">
                      <img src="${comment.profile_pic}" alt="${comment.username}" class="profile-pic">
                      <span class="username">${comment.username}</span>
                  </div>
              `;
              commentsContainer.appendChild(commentBox);
          });
      })
      .catch(error => {
          console.error('Error fetching comments:', error);
      });
}
// Fetch comments when the page initially loads

document.addEventListener('DOMContentLoaded', fetchAndAppendComments);

    var swiper = new Swiper(".swiper", {
    effect: "cards",
    grabCursor: true,
    initialSlide: 2,
    speed: 500,
    loop: true,
    rotate: true,
    mousewheel: {
    invert: false,
  },
});

// Handle form submission
document.getElementById('comment-form').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission

    // Get comment text and rating from the form
    const commentText = document.getElementById('comment-text').value;
    const commentRating = document.getElementById('comment-rating').value;

    // Send the comment data to the server
    fetch('/add-comment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            text: commentText,
            rating: commentRating
        })
    })
    .then(response => response.json())
    .then(comment => {
        // Fetch and append comments again after successful submission
        fetchAndAppendComments();
        // Clear the form
        document.getElementById('comment-text').value = '';
        document.getElementById('comment-rating').value = '';
    })
    .catch(error => {
        console.error('Error adding comment:', error);
    });
});

// Function to generate star icons based on rating
function generateStars(rating) {
    let starsHtml = '';
    for (let i = 0; i < 5; i++) {
        if (i < rating) {
            starsHtml += '<span class="star full">★</span>'; // Full star
        } else {
            starsHtml += '<span class="star empty">☆</span>'; // Empty star
        }
    }
    return starsHtml;
}


// Smooth horizontal scrolling
let isScrolling = false;

document.getElementById('comments-container').addEventListener('mousedown', (e) => {
    isScrolling = true;
    startX = e.pageX - document.getElementById('comments-container').offsetLeft;
    scrollLeft = document.getElementById('comments-container').scrollLeft;
});

document.getElementById('comments-container').addEventListener('mouseleave', () => {
    isScrolling = false;
});

document.getElementById('comments-container').addEventListener('mouseup', () => {
    isScrolling = false;
});

document.getElementById('comments-container').addEventListener('mousemove', (e) => {
    if (!isScrolling) return;
    e.preventDefault();
    const x = e.pageX - document.getElementById('comments-container').offsetLeft;
    const walk = (x - startX) * 2; // Change the multiplier for faster/slower scrolling
    document.getElementById('comments-container').scrollLeft = scrollLeft - walk;
});

document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('comments-container');
    const leftArrow = document.getElementById('left-arrow');
    const rightArrow = document.getElementById('right-arrow');
    
    // Fetch and append comments initially
    fetchAndAppendComments();

    // Assuming fetchAndAppendComments also initializes dots based on comments
    // For simplicity, here's a placeholder function to update active dot
    function updateActiveDot(index) {
        const dots = document.querySelectorAll('.dot');
        dots.forEach(dot => dot.classList.remove('active'));
        dots[index].classList.add('active');
    }

    leftArrow.addEventListener('click', () => {
        // Scroll to the previous comment
        container.scrollBy({ left: -container.offsetWidth, behavior: 'smooth' });
        // Update active dot here based on scroll position or index
    });

    rightArrow.addEventListener('click', () => {
        // Scroll to the next comment
        container.scrollBy({ left: container.offsetWidth, behavior: 'smooth' });
        // Update active dot here based on scroll position or index
    });

    // Optional: Listen to scroll event to update dots based on current view
});

// Ensure fetchAndAppendComments() and generateStars() are implemented as discussed


</script>
{% endblock %}
